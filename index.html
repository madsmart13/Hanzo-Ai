<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hanzo AI â€“ 3D Spherical Assistant</title>
<style>
    body {
        margin: 0;
        background: #080810;
        display: flex;
        height: 100vh;
        overflow: hidden;
        font-family: 'Tahoma', sans-serif;
        color: #fff;
    }

    #sceneContainer {
        width: 55%;
        height: 100%;
        background: radial-gradient(circle, #0a0a16, #000);
    }

    #chatContainer {
        width: 45%;
        height: 100%;
        display: flex;
        flex-direction: column;
        padding: 20px;
        background: rgba(20, 10, 40, 0.7);
        backdrop-filter: blur(10px);
        border-left: 2px solid rgba(120, 60, 255, 0.3);
    }

    #messages {
        flex: 1;
        overflow-y: auto;
        padding-right: 10px;
    }

    .msg {
        margin: 8px 0;
        padding: 10px 14px;
        border-radius: 12px;
        max-width: 85%;
        line-height: 1.5;
        font-size: 15px;
    }

    .msg.user {
        background: #5d2bff;
        margin-left: auto;
    }

    .msg.ai {
        background: #1a1a2b;
        border: 1px solid #6b42ff;
    }

    #inputBox {
        display: flex;
        margin-top: 12px;
    }

    #userInput {
        flex: 1;
        padding: 12px;
        border-radius: 10px;
        border: none;
        outline: none;
        font-size: 15px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    #sendBtn {
        padding: 12px 18px;
        margin-left: 10px;
        border: none;
        border-radius: 10px;
        background: #7b46ff;
        cursor: pointer;
        color: #fff;
        font-weight: bold;
        transition: 0.2s;
    }

    #sendBtn:hover {
        background: #9e6dff;
    }
</style>
</head>
<body>

<div id="sceneContainer"></div>

<div id="chatContainer">
    <div id="messages"></div>

    <div id="inputBox">
        <input id="userInput" placeholder="Ù¾ÛŒØ§Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

<script>
// ------------------------- 3D Scene ------------------------------
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth * 0.55 / window.innerHeight, 0.1, 1000);
camera.position.set(0, 0, 4);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth * 0.55, window.innerHeight);
document.getElementById("sceneContainer").appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableZoom = false;
controls.enablePan = false;
controls.autoRotate = true;
controls.autoRotateSpeed = 1;

// Core spherical character
const geo = new THREE.SphereGeometry(1, 64, 64);
const mat = new THREE.MeshStandardMaterial({ color: 0x7b46ff, roughness: 0.3, metalness: 0.7 });
const hanzo = new THREE.Mesh(geo, mat);
scene.add(hanzo);

// Lights
scene.add(new THREE.AmbientLight(0xffffff, 0.4));
const dir = new THREE.DirectionalLight(0xffffff, 1);
dir.position.set(3, 2, 5);
scene.add(dir);

function animate() {
    requestAnimationFrame(animate);
    hanzo.rotation.y += 0.005;
    controls.update();
    renderer.render(scene, camera);
}
animate();

</script>

<!-- ------------------- Chat + Sending Fix ------------------------ -->
<script>
window.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const messages = document.getElementById("messages");

    if (!input || !sendBtn || !messages) {
        console.error("âŒ Ø¹Ù†Ø§ØµØ± Ú†Øª Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯Ù†");
        return;
    }

    function sendMessage() {
        const text = input.value.trim();
        if (text === "") return;

        addMessage("user", text);
        input.value = "";

        setTimeout(() => {
            addMessage("ai", "Ù¾Ø§Ø³Ø® ØªØ³ØªÛŒ Ù‡Ø§Ù†Ø²Ùˆ: " + text);
        }, 600);
    }

    sendBtn.addEventListener("click", sendMessage);

    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });

    function addMessage(sender, text) {
        const msg = document.createElement("div");
        msg.className = "msg " + sender;
        msg.textContent = text;
        messages.appendChild(msg);
        messages.scrollTop = messages.scrollHeight;
    }
});
</script>

<!-- ğŸ”¥ Hanzo Connected to OpenAI (ChatGPT) -->
<script>
// âš ï¸ Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…
// Ø¨Ø§ÛŒØ¯ Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯Øª Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡ÛŒ â€” Ú©Ù„ÛŒØ¯ ChatGPT Ù…Ù† Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†ÛŒØ³Øª.
// Ú©Ù„ÛŒØ¯ Ø±Ø§ Ø¯Ø§Ø®Ù„ Netlify / Vercel / Cloudflare Pages Ù…Ø®ÙÛŒ Ú©Ù†ØŒ Ù‡Ø±Ú¯Ø² Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ø± Ú¯ÛŒØªÙ‡Ø§Ø¨ Ù†Ø°Ø§Ø±.

const OPENAI_API_KEY = "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";

async function queryAI(message, onChunk) {
    const response = await fetch("https://api.openai.com/v1/responses", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
            model: "gpt-4.1-mini",
            input: message,
            stream: true
        })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split("
");

        for (const line of lines) {
            if (line.trim().startsWith("data:")) {
                const json = line.replace("data:", "").trim();
                if (json === "[DONE]") continue;

                try {
                    const parsed = JSON.parse(json);
                    const text = parsed.output_text || parsed.delta || "";
                    if (text) onChunk(text);
                } catch {}
            }
        }
    }
}
</script>

<script>
// Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ú†Øª Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
window.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const messages = document.getElementById("messages");

    function sendMessage() {
        const text = input.value.trim();
        if (text === "") return;

        addMessage("user", text);
        input.value = "";

        let aiMsg = addMessage("ai", "");

        queryAI(text, (chunk) => {
            aiMsg.textContent += chunk;
            messages.scrollTop = messages.scrollHeight;
        });
    }

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });

    function addMessage(sender, text) {
        const msg = document.createElement("div");
        msg.className = "msg " + sender;
        msg.textContent = text;
        messages.appendChild(msg);
        messages.scrollTop = messages.scrollHeight;
        return msg;
    }
});
</script>

</body>
</html>
